<!--Page header-->
<div class="page-header">
        <div class="page-leftheader">
                <h4 class="page-title">Gestión de Físico</h4>
        </div>
        <div class="page-rightheader ms-auto d-lg-flex d-none">
                <ol class="breadcrumb">
                        <li class="breadcrumb-item">
                                <a class="d-flex">
                                        <svg class="svg-icon" xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24">
                                                <path d="M0 0h24v24H0V0z" fill="none" />
                                                <path d="M12 3L2 12h3v8h6v-6h2v6h6v-8h3L12 3zm5 15h-2v-6H9v6H7v-7.81l5-4.5 5 4.5V18z"/>
                                                <path d="M7 10.19V18h2v-6h6v6h2v-7.81l-5-4.5z" opacity=".3"/>
                                        </svg>
                                        <span class="breadcrumb-icon">Home</span>
                                </a>
                        </li>
                        <li class="breadcrumb-item">Fisicos</li>
                        <li class="breadcrumb-item active" aria-current="page">Consumo Masivo</li>
                        <li class="breadcrumb-item active" aria-current="page">Gestión del Físico</li>
                </ol>
        </div>
</div>
    
      <div class="row row-deck">   
        <div class="container">
            <div class="row">
                <div class="col-xl-4 col-lg-6 col-md-6">
                        <div class="card">       
                                <div class="card-body">
                                        <div class="row">
                                                <div  class="col-xl-6 col-lg-6 col-md-6">
                                                        <label class="form-label">Sociedad <span class="text-red">*</span></label>
                                                        <ng-select class="form-control form-select" [(ngModel)]="sociedadSelected">
                                                            <ng-option value={{sociedad.t033_ID}} *ngFor="let sociedad of sociedades">{{sociedad.t033_Name}}</ng-option>
                                                        </ng-select>
                                                </div>
                                                <div  class="ccol-xl-6 col-lg-6 col-md-6">
                                                    <label class="form-label">Subyacente<span class="text-red">*</span></label>
                                                    <ng-select class="form-control form-select" [(ngModel)]="productoSelected" (change)="onSelectSubyacente($event)" >
                                                        <ng-option value={{producto.t001_ID}} *ngFor="let producto of productos">{{producto.t001_Description}}</ng-option>
                                                    </ng-select>
                                            </div>
                                        </div>
                                </div>
                        </div>
                </div>
                <div  class="col-xl-2 col-lg-3 col-md-4">
                        <div class="card">
                                <div class="card-body">
                                        <div class="row">
                                                <button type="button" class="btnresponsive btn btn-white " id='b1' aria-expanded="false" (click)="cerrarPortafolioModal(cerrarPortafolio)" [disabled]="!usuarioMO"><i class="fa fa-lock"></i> Realizar Cierre</button>
                                        </div>
                                        <br>
                                        <div class="row">
                                                <button type="button" class="btnresponsive btn btn-white " id='b1' aria-expanded="false" (click)="deshacerCierrePortafolioModal(cerrarPortafolio)" [disabled]="!usuarioMO"><i class="fa fa-unlock"></i>  Deshacer Cierre</button>
                                        </div>
                                </div>
                        </div>
                </div>
                <div  class="col-xl-2 col-lg-2 col-md-1">
                        <div class="card">
                                <div class="card-body">
                                        <div class="row">
                                                <button type="button" class="btnresponsive btn btn-white" id='b1' (click)="cargarPrima()" aria-expanded="false">Cargar Prima y Spread</button>
                                        </div>
                                        <br>
                                        <div class="row">
                                                <button type="button" class="btnresponsive btn btn-white" id='b1' (click)="crearFuturoModal(crearPricing)" aria-expanded="false">Crear Futuro</button>
                                        </div>
                                </div>
                        </div>
                </div>
                <div  class="col-xl-2 col-lg-2 col-md-1">
                        <div class="card">
                                <div class="card-body">
                                        <div class="row">
                                                <button type="button" class="btnresponsive btn btn-white" id='b1' (click)="calcularMTMModal()" aria-expanded="false">Calcular MTM</button>
                                        </div>
                                        <br>
                                        <div class="row">
                                                <button type="button" class="btnresponsive btn btn-white" id='b1' (click)="modalConsultarPortafolio(consultaPortafolio)" aria-expanded="false"><i class="fa fa-search"></i> Consultar Portafolio</button>
                                        </div>
                                </div>
                        </div>
                </div>
                <!-- <div  class="col-xl-2 col-lg-3 col-md-4">
                        <div class="card">
                                <div class="card-body">
                                        <div class="row">
                                                <button type="button" class="btnresponsive btn btn-white" id='b1' (click)="modalConsultarPortafolio(consultaPortafolio)" aria-expanded="false"><i class="fa fa-search"></i> Consultar Portafolio</button>
                                        </div>
                                </div>
                        </div>
                </div> -->
                
                <mat-stepper  #stepper>
                        <ng-template matStepperIcon="edit">
                                <mat-icon>adjust</mat-icon>
                        </ng-template>
                    <mat-step  label="Open">
                      <!-- <form [formGroup]="firstFormGroup"> -->
                    <ng-template matStepLabel>OPEN<span class="material-icons-round">move_to_inbox</span></ng-template>
                    <br>
                    <div class="card">
                            <div class="card-header">
                                <div class="btn-group ms-1 mb-0 justify-content-start">
                                        <div *ngIf="estadoPortafolio" class="row">
                                                <!-- <a class="btn btn-abierto btn-sm mt-6 justify-content-start">PORTAFOLIO ABIERTO</a> -->
                                                <h5 class="mb-0"><i class="fa fa-check-circle"style="font-size:180%;color:green"></i> PORTAFOLIO ABIERTO</h5>
                                        </div>
                                        <div *ngIf="!estadoPortafolio" class="row">
                                                <h5><i class="fa fa-times-circle"style="font-size:180%;color:red"></i> PORTAFOLIO CERRADO</h5>
                                        </div> 
                                </div>
                                    <div class="card-options" ngbDropdown>
                                            <div class="btn-group ms-5 mb-0">
                                              <button
                                                type="button"
                                                class="btn btn-white"
                                                aria-expanded="false"
                                                data-toggle="modal"
                                                (click)="agregarOperacion(IngresarFactura)">
                                                <i class="fe fe-plus"></i>Agregar Operación
                                              </button>
                                            </div>
                                    </div>
                            </div>
                            <a class="d-flex py-2" style="padding-left: 1.3%">
                            <span class="w-3 h-3 brround theadCarga me-2"></span> Periodo de Carga
                            <div style="padding-left: 1.3%"></div>
                            <span class="w-3 h-3 brround theadFlat me-2"></span> Flat
                            <div style="padding-left: 1.3%"></div>
                            <span class="w-3 h-3 brround theadFuturo me-2"></span> Futuros
                            <div style="padding-left: 1.3%"></div>
                            <span class="w-3 h-3 brround theadBase me-2"></span> Bases
                            <div style="padding-left: 1.3%"></div>
                            <span class="w-3 h-3 brround theadPortafolio me-2"></span> General
                            <div style="padding-left: 1.3%"></div>
                            <span class="w-3 h-3 brround theadMtM me-2"></span> Valores MtM
                            <div style="padding-left: 1.3%"></div>
                            </a>
                            <div class="card-body">
                                    <div>
                                              <input type="text" class="redondeado buscador"  size="100"    (keyup)="applyFilterOpen($event)" placeholder=" Buscar Barco " autocomplete="off" [(ngModel)]="filtro">
                                             <br><br>
                                     </div>
                                   <div  class="table-responsive">
                                     <div class="tabla-table-container">
                                             <table mat-table 
                                             class="table table-bordered text-nowrap"  
                                             class="example-table table-bordered"
                                             matSort matSortActive="created" matSortDisableClear matSortDirection="desc"
                                             style="width:100%"  
                                             [dataSource]="portafolioOpenDS" >
    
                                                <ng-container  matColumnDef="s021_Parent">
                                                        <th  mat-header-cell *matHeaderCellDef mat-sort-header> Contrato <br />Padre </th>
                                                        <td mat-cell *matCellDef="let element"> 
                                                        <div *ngIf="element.s021_Parent != 0" (click)="listarHijos(ListaHijos, element.s021_Codigo)">
                                                        <i  class="fa fa-black-tie fa-2x" style="color:#37aaf1;" aria-hidden="true"></i>
                                                        </div>
                                                        </td>
                                                </ng-container>
                                                <ng-container matColumnDef="s021_Codigo">
                                                        <th class="thead" class="border-bottom-0" mat-header-cell *matHeaderCellDef mat-sort-header> Código </th>
                                                        <td mat-cell *matCellDef="let elementOpen"> {{elementOpen.s021_Codigo}} </td>
                                                </ng-container>
                                                <ng-container matColumnDef="s021_Split">
                                                             <th mat-header-cell *matHeaderCellDef mat-sort-header> Split </th>
                                                             <td mat-cell *matCellDef="let elementOpen"> {{elementOpen.s021_Split}} </td>
                                                </ng-container>
                                                <ng-container class="border-bottom-0" matColumnDef="s021_Proveedor">
                                                        <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                                                <mat-form-field>
                                                                <mat-label style="color:white">Proveedor</mat-label>
                                                                <mat-select name="s021_Proveedor" (selectionChange)="seleccionarFiltro()" [(ngModel)]="proveedorfiltrado" multiple>
                                                                        <mat-option *ngFor="let proveedor of filtroProveedor" [value]="proveedor">{{proveedor}}</mat-option>
                                                                </mat-select>
                                                                </mat-form-field>
                                                        </th>
                                                        
                                                        <td mat-cell *matCellDef="let elementOpen"> {{elementOpen.s021_Proveedor}} </td>
                                                       <!-- <th mat-header-cell *matHeaderCellDef mat-sort-header> Proveedor </th>
                                                       <td mat-cell *matCellDef="let elementOpen"> {{elementOpen.s021_Proveedor}} </td> -->
                                                </ng-container>
                                                <ng-container  class="border-bottom-0" matColumnDef="s021_SociedadNA">
                                                       <th mat-header-cell *matHeaderCellDef mat-sort-header> Sociedad Nutrición Animal </th>
                                                       <td mat-cell *matCellDef="let elementOpen"> {{elementOpen.s021_SociedadNA}} </td>
                                                </ng-container>
                                                <ng-container  class="border-bottom-0" matColumnDef="s021_SociedadCH">
                                                        <th mat-header-cell *matHeaderCellDef mat-sort-header> Sociedad Consumo Humano </th>
                                                        <td mat-cell *matCellDef="let elementOpen"> {{elementOpen.s021_SociedadCH}} </td>
                                                 </ng-container>
                                                <ng-container  class="border-bottom-0" matColumnDef="s021_Embarque">
                                                        <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                                                <mat-form-field>
                                                                <mat-label style="color:white">Embarque</mat-label>
                                                                <mat-select name="s021_Embarque" (selectionChange)="seleccionarFiltro()" [(ngModel)]="embarquefiltrado" multiple>
                                                                        <mat-option *ngFor="let embarque of filtroEmbarque" [value]="embarque">{{embarque}}</mat-option>
                                                                </mat-select>
                                                                </mat-form-field>
                                                        </th>
                                                        
                                                        <td mat-cell *matCellDef="let elementOpen"> {{elementOpen.s021_Embarque}} </td>

                                                        <!-- <th mat-header-cell *matHeaderCellDef mat-sort-header> Embarque </th>
                                                        <td mat-cell *matCellDef="let elementOpen"> {{elementOpen.s021_Embarque}} </td> -->
                                                </ng-container>                      
                                                <ng-container class="border-bottom-0" matColumnDef="s021_InicioCarga">
                                                        <th mat-header-cell *matHeaderCellDef mat-sort-header class="theadCarga"> Desde </th> 
                                                        <td mat-cell *matCellDef="let elementOpen">  {{elementOpen.s021_InicioCarga | date: "dd/MM/yyyy"}} </td>
                                                </ng-container>
                                                <ng-container matColumnDef="s021_FinCarga">
                                                        <th mat-header-cell *matHeaderCellDef mat-sort-header class="theadCarga"> Hasta </th>
                                                        <td mat-cell *matCellDef="let elementOpen"> {{elementOpen.s021_FinCarga | date: "dd/MM/yyyy"}} </td>
                                                </ng-container>
                                                <ng-container matColumnDef="s021_FechaArribo">
                                                        <th mat-header-cell *matHeaderCellDef mat-sort-header> Arribo estimado</th>
                                                        <td mat-cell *matCellDef="let elementOpen"> {{elementOpen.s021_FechaArribo | date: "dd/MM/yyyy"}} </td>
                                                </ng-container>
                                                <ng-container matColumnDef="s021_TipoBase">
                                                        <th mat-header-cell *matHeaderCellDef mat-sort-header> Incoterm </th>
                                                        <td mat-cell *matCellDef="let elementOpen"> {{elementOpen.s021_TipoBase}} </td>
                                                </ng-container>
                                                <ng-container matColumnDef="s021_Contrato">
                                                        <th mat-header-cell *matHeaderCellDef mat-sort-header> Contrato </th>
                                                        <td mat-cell *matCellDef="let elementOpen"> {{elementOpen.s021_Contrato}} </td>
                                                </ng-container>
                                                <ng-container matColumnDef="s021_Tipo">
                                                        <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                                                <mat-form-field>
                                                                <mat-label style="color:white">Tipo</mat-label>
                                                                <mat-select name="s021_Tipo" (selectionChange)="seleccionarFiltro()" [(ngModel)]="tipofiltrado" multiple>
                                                                        <mat-option *ngFor="let tipo of filtroTipo" [value]="tipo">{{tipo}}</mat-option>
                                                                </mat-select>
                                                                </mat-form-field>
                                                        </th>
                                                        
                                                        <td mat-cell *matCellDef="let elementOpen"> {{elementOpen.s021_Tipo}} </td>

                                                        <!-- <th mat-header-cell *matHeaderCellDef mat-sort-header> Tipo </th>
                                                        <td mat-cell *matCellDef="let elementOpen"> {{elementOpen.s021_Tipo}} </td> -->
                                                </ng-container>
                                                <ng-container matColumnDef="s021_Proteina">
                                                        <th mat-header-cell *matHeaderCellDef mat-sort-header> Prot. % </th>
                                                        <td mat-cell *matCellDef="let elementOpen"> {{elementOpen.s021_Proteina}} </td>
                                                </ng-container>
                                                <ng-container matColumnDef="s021_Tolerancia">
                                                        <th mat-header-cell *matHeaderCellDef mat-sort-header> Tolerancia </th>
                                                        <td mat-cell *matCellDef="let elementOpen"> {{(elementOpen.s021_Tolerancia * 100) | number:'1.2-2' }} % </td>
                                                </ng-container>
                                                <ng-container matColumnDef="s021_TipoPrecio">
                                                        <th mat-header-cell *matHeaderCellDef mat-sort-header> Tipo de <br/>Precio </th> 
                                                        <td mat-cell *matCellDef="let elementOpen"> {{elementOpen.s021_TipoPrecio}} </td>
                                                </ng-container> 
                                                <ng-container matColumnDef="s021_Bolsa">
                                                        <th mat-header-cell *matHeaderCellDef mat-sort-header> Ticker </th>
                                                        <td mat-cell *matCellDef="let elementOpen"> {{elementOpen.s021_Bolsa}} </td>
                                                </ng-container>
                                                <ng-container matColumnDef="s021_Futuro">
                                                        <th mat-header-cell *matHeaderCellDef mat-sort-header> Futuro </th>
                                                        <td mat-cell *matCellDef="let elementOpen"> {{elementOpen.s021_Futuro }} </td>
                                                </ng-container>
                                                <ng-container matColumnDef="s021_Volumen">
                                                        <th mat-header-cell *matHeaderCellDef mat-sort-header> Volumen (TM) </th>
                                                        <td mat-cell *matCellDef="let elementOpen"> {{elementOpen.s021_Volumen}} </td>
                                                </ng-container>
                                                <ng-container matColumnDef="s021_NumeroContratos">
                                                        <th mat-header-cell *matHeaderCellDef mat-sort-header> # Contratos </th>
                                                        <td mat-cell *matCellDef="let elementOpen"> {{elementOpen.s021_NumeroContratos | number:'1.0-0'}} </td>
                                                </ng-container>
                                                <ng-container matColumnDef="s021_Flat">
                                                        <th mat-header-cell *matHeaderCellDef mat-sort-header class="theadFlat"> Flat Price </th>
                                                        <td mat-cell *matCellDef="let elementOpen"> {{elementOpen.s021_Flat | number:'1.2-2'}} </td>
                                                </ng-container>
                                                <ng-container matColumnDef="s021_PrecioPromedio">
                                                        <th mat-header-cell *matHeaderCellDef mat-sort-header class="theadFuturo"> Futuro (Fijado) </th>
                                                        <td mat-cell *matCellDef="let elementOpen"> {{elementOpen.s021_PrecioPromedio | number:'1.2-2'}} </td>
                                                </ng-container>
                                                <ng-container matColumnDef="s021_ContratosCubiertos">
                                                        <th mat-header-cell *matHeaderCellDef mat-sort-header class="theadFuturo"> Futuros Fijados caks </th>
                                                        <td mat-cell *matCellDef="let elementOpen"> {{elementOpen.s021_ContratosCubiertos | number:'1.0-0'}} </td>
                                                </ng-container>
                                                <ng-container matColumnDef="s021_ContratosNoCubiertos">
                                                        <th mat-header-cell *matHeaderCellDef mat-sort-header class="theadFuturo"> Saldo Futuros caks </th>
                                                        <td mat-cell *matCellDef="let elementOpen"> {{ elementOpen.s021_ContratosNoCubiertos | number:'1.0-0'}} </td>
                                                </ng-container>
                                                <ng-container matColumnDef="s021_PrecioPromedioBases">
                                                        <th mat-header-cell *matHeaderCellDef mat-sort-header class="theadBase"> Base (Fijado) </th>
                                                        <td mat-cell *matCellDef="let elementOpen"> {{elementOpen.s021_PrecioPromedioBases | number:'1.2-2'}} </td>
                                                </ng-container>
                                                <ng-container matColumnDef="s021_ContratosCubiertosxBases">
                                                        <th mat-header-cell *matHeaderCellDef mat-sort-header class="theadBase"> Bases Fijadas TM </th>
                                                        <td mat-cell *matCellDef="let elementOpen"> {{elementOpen.s021_ContratosCubiertosxBases | number:'1.0-0'}} </td>
                                                </ng-container>
                                                <ng-container matColumnDef="s021_SaldoBases">
                                                        <th mat-header-cell *matHeaderCellDef mat-sort-header class="theadBase"> Saldo Bases TM </th>
                                                        <td mat-cell *matCellDef="let elementOpen"> {{elementOpen.s021_Volumen - elementOpen.s021_ContratosCubiertosxBases  | number:'1.2-2'}} </td>
                                                </ng-container>
                                                <ng-container matColumnDef="s021_Precio">
                                                        <th mat-header-cell *matHeaderCellDef mat-sort-header> Precio </th>
                                                        <td mat-cell *matCellDef="let elementOpen"> {{elementOpen.s021_Precio}} </td>
                                                </ng-container>
                                                <ng-container matColumnDef="s021_OtrosCostos">
                                                        <th mat-header-cell *matHeaderCellDef mat-sort-header> Otros Costos / <br/>Descuentos </th>
                                                        <td mat-cell *matCellDef="let elementOpen"> {{elementOpen.s021_OtrosCostos | number:'1.2-2'}} </td>
                                                </ng-container>
                                                <ng-container matColumnDef="Futuro">
                                                        <th mat-header-cell *matHeaderCellDef mat-sort-header> Futuro </th>
                                                        <td mat-cell *matCellDef="let elementOpen"> PENDIENTE </td>
                                                </ng-container>
                                                <ng-container matColumnDef="s021_Flete">
                                                        <th mat-header-cell *matHeaderCellDef mat-sort-header> Flete </th>
                                                        <td mat-cell *matCellDef="let elementOpen"> {{elementOpen.s021_Flete | number:'1.2-2'}} </td>
                                                </ng-container>
                                                <ng-container matColumnDef="s021_FOBFijado">
                                                        <th mat-header-cell *matHeaderCellDef mat-sort-header> FOB Fijado </th>
                                                        <td mat-cell *matCellDef="let elementOpen"> {{elementOpen.s021_FOBFijado | number:'1.2-2'}} </td>
                                                </ng-container>
                                                <ng-container matColumnDef="s021_PnLAsignado">
                                                        <th mat-header-cell *matHeaderCellDef mat-sort-header> PnL Asignado </th>
                                                        <td mat-cell *matCellDef="let elementOpen"> {{elementOpen.s021_PnLAsignado}} </td>
                                                </ng-container>
                                                <ng-container matColumnDef="s021_ValorTotalFijado">
                                                        <th mat-header-cell *matHeaderCellDef mat-sort-header> Valor Total Fijados (FOB) </th>
                                                        <td mat-cell *matCellDef="let elementOpen"> {{elementOpen.s021_ValorTotalFijado | number:'1.0-0'}} </td>
                                                </ng-container>
                                                <ng-container matColumnDef="s021_ValorFuturo">
                                                        <th mat-header-cell *matHeaderCellDef mat-sort-header class="theadMtM"> Valor Futuro </th>
                                                        <td mat-cell *matCellDef="let elementOpen"> {{elementOpen.s021_ValorFuturo | number:'1.2-2'}} </td>
                                                </ng-container>
                                                <ng-container matColumnDef="s021_FechaBase">
                                                        <th mat-header-cell *matHeaderCellDef mat-sort-header class="theadMtM"> Fecha Base </th>
                                                        <td mat-cell *matCellDef="let elementOpen"> {{elementOpen.s021_FechaBase }} </td>
                                                </ng-container>
                                                <ng-container matColumnDef="s021_ValorBase">
                                                        <th mat-header-cell *matHeaderCellDef mat-sort-header class="theadMtM"> Valor Base </th>
                                                        <td mat-cell *matCellDef="let elementOpen"> {{elementOpen.s021_ValorBase | number:'1.2-2'}} </td>
                                                </ng-container>
                                                <ng-container matColumnDef="s021_FechaFlat">
                                                        <th mat-header-cell *matHeaderCellDef mat-sort-header class="theadMtM"> Fecha Flat </th>
                                                        <td mat-cell *matCellDef="let elementOpen"> {{elementOpen.s021_FechaFlat}} </td>
                                                </ng-container>
                                                <ng-container matColumnDef="s021_ValorFlat">
                                                        <th mat-header-cell *matHeaderCellDef mat-sort-header class="theadMtM"> Valor Flat </th>
                                                        <td mat-cell *matCellDef="let elementOpen"> {{elementOpen.s021_ValorFlat | number:'1.2-2'}} </td>
                                                </ng-container>
                                                <ng-container matColumnDef="s021_MtM">
                                                        <th mat-header-cell *matHeaderCellDef mat-sort-header class="theadMtM"> MtM </th>
                                                        <td mat-cell *matCellDef="let elementOpen"> {{elementOpen.s021_MtM | number:'1.2-2'}} </td>
                                                </ng-container>
                                
                                                <tr mat-header-row *matHeaderRowDef="columnsOpen sticky: true" 
                                                        style="text-align: center; vertical-align: middle;" ></tr>
                                                     
                                                <tr class="tbody" (contextmenu)="onContextMenu($event, elementOpen.s021_Codigo)" mat-row *matRowDef="let elementOpen; columns: columnsOpen;"
                                                     style="text-align: center; vertical-align: middle;" 
                                                     [class.selected]="elementOpen.selected"
                                                     (click)="elementOpen.selected= !elementOpen.selected">
                                                </tr>
                                        </table>
                                     </div>
                                    </div>
                                    <mat-paginator [pageSizeOptions]="[10,15, 25, 100]"></mat-paginator>
                            </div>  
                            <div
                                    style="visibility: hidden; position: fixed"
                                    [style.left]="contextMenuPosition.x"
                                    [style.top]="contextMenuPosition.y"
                                    [matMenuTriggerFor]="menuTriggerOpen">
                            </div>
                            <mat-menu #menuTriggerOpen="matMenu">
                                    <ng-template matMenuContent let-item="item">
                                            <button mat-menu-item (click)="modificarOperacion(IngresarFactura)">Modificar</button>       
                                            <button mat-menu-item (click)="ModaldividirOperacion()">Dividir</button>       
                                            <button mat-menu-item (click)="cancelarOperacion()">Cancelar</button>       
                                            <button mat-menu-item (click)="pasarTransito(PasarTransito)">Mover a Transito</button>       
                                            <button mat-menu-item [matMenuTriggerFor]="bases">Bases</button>           
                                            <!-- <button mat-menu-item (click)="crearFuturoModal(crearPricing)">Crear Futuro</button>            -->
                                            <!-- <button mat-menu-item (click)="asignarFuturoModal(asignarPricing)">Asignar Futuro</button>            -->
                                            <button mat-menu-item [matMenuTriggerFor]="pricing">Futuros</button>           
                                    </ng-template>
                            </mat-menu>
                            <mat-menu #bases="matMenu">
                                    <a mat-menu-item (click)="ingresarBaseModal(IngresarBase)">Comprar</a>
                                    <a mat-menu-item (click)="listarBasesModal(ListarBases)">Mostrar</a>
                            </mat-menu>
                            <mat-menu #pricing="matMenu">
                                    <a mat-menu-item (click)="comprarFuturoModal(comprarFuturo)">Comprar</a>
                                    <a mat-menu-item (click)="asignarFuturoModal(asignarPricing)">Asignar</a>
                                    <a mat-menu-item (click)="venderFuturoModal(venderFuturo)">Vender</a>
                                    <a mat-menu-item (click)="listarFuturoModal(listarFuturos)">Mostrar</a>
                            </mat-menu>
                    </div>
                      <!-- </form> -->
                    </mat-step>
                    <!-- #docregion label -->
                    <mat-step >
                    <ng-template matStepLabel>TRANSITO<span class="material-icons-round">directions_boat</span></ng-template>
                      <!-- <form [formGroup]="secondFormGroup"> -->
                            <br>
                            <div class="card">
                                    <div class="card-header">
                                    </div>
                                    <div class="card-body">
                                            <div>
                                                <input type="text" class="redondeado buscador"  size="100" (keyup)="applyFilterTransito($event)" placeholder=" Buscar Transito" autocomplete="off">
                                                <br><br>
                                             </div>
                                           <div  class="table-responsive">
                                             <div class="tabla-table-container">
                                                     <table mat-table 
                                                     #sortPortafolioTransito="matSort"
                                                     class="table table-bordered text-nowrap"  
                                                     class="example-table table-bordered"
                                                     matSort matSortActive="created" matSortDisableClear matSortDirection="desc"
                                                     style="width:100%"  
                                                     [dataSource]="portafolioTransitoDS" >
            
                                                        <ng-container  matColumnDef="opciones">
                                                                <th  mat-header-cell *matHeaderCellDef mat-sort-header>Opciones</th>
                                                                <td mat-cell *matCellDef="let elementTransito"
                                                                (click)="onContextMenuTransito($event, elementTransito.s021_Codigo)" [matMenuTriggerFor]="menuTriggerTransito"> 
                                                                <button mat-icon-button class="opcion">
                                                                <mat-icon>more_vert</mat-icon>
                                                                </button>
                                                                </td>
                                                        </ng-container>
                                                             <ng-container matColumnDef="s021_Codigo">
                                                               <th class="thead" class="border-bottom-0" mat-header-cell *matHeaderCellDef mat-sort-header> Código </th>
                                                               <td mat-cell *matCellDef="let elementTransito"> {{elementTransito.s021_Codigo}} </td>
                                                             </ng-container>
                                                             <ng-container class="border-bottom-0" matColumnDef="s021_Proveedor">
                                                               <th mat-header-cell *matHeaderCellDef mat-sort-header> Proveedor </th>
                                                               <td mat-cell *matCellDef="let elementTransito"> {{elementTransito.s021_Proveedor}} </td>
                                                             </ng-container>
                                                     
                                                             <ng-container  class="border-bottom-0" matColumnDef="s021_SociedadNA">
                                                               <th mat-header-cell *matHeaderCellDef mat-sort-header> Sociedad Nutrición <br/>Animal </th>
                                                               <td mat-cell *matCellDef="let elementTransito"> {{elementTransito.s021_SociedadNA}} </td>
                                                             </ng-container>
                                                              <ng-container  class="border-bottom-0" matColumnDef="s021_SociedadCH">
                                                                        <th mat-header-cell *matHeaderCellDef mat-sort-header> Sociedad Consumo Humano </th>
                                                                        <td mat-cell *matCellDef="let elementOpen"> {{elementOpen.s021_SociedadCH}} </td>
                                                                </ng-container>
                                                             <ng-container  class="border-bottom-0" matColumnDef="s021_Embarque">
                                                                     <th mat-header-cell *matHeaderCellDef mat-sort-header> Embarque </th>
                                                                     <td mat-cell *matCellDef="let elementTransito"> {{elementTransito.s021_Embarque}} </td>
                                                             </ng-container>                      
                                                             <ng-container class="border-bottom-0" matColumnDef="s021_InicioCarga">
                                                                     <th mat-header-cell *matHeaderCellDef mat-sort-header> Desde </th> 
                                                                     <td mat-cell *matCellDef="let elementTransito">  {{elementTransito.s021_InicioCarga | date: "dd/MM/yyyy"}} </td>
                                                             </ng-container>
                                                             <ng-container matColumnDef="s021_FinCarga">
                                                                     <th mat-header-cell *matHeaderCellDef mat-sort-header> Hasta </th>
                                                                     <td mat-cell *matCellDef="let elementTransito"> {{elementTransito.s021_FinCarga | date: "dd/MM/yyyy"}} </td>
                                                             </ng-container>
                                                             <ng-container matColumnDef="s021_Agrupador">
                                                                     <th mat-header-cell *matHeaderCellDef mat-sort-header> Agrupador</th>
                                                                     <td mat-cell *matCellDef="let elementTransito"> {{elementTransito.s021_Agrupador}} </td>
                                                             </ng-container>
                                                             <ng-container matColumnDef="s021_Contrato">
                                                                     <th mat-header-cell *matHeaderCellDef mat-sort-header> Contrato </th>
                                                                     <td mat-cell *matCellDef="let elementTransito"> {{elementTransito.s021_Contrato}} </td>
                                                             </ng-container>
                               
                                                             <ng-container matColumnDef="s021_Tipo">
                                                                     <th mat-header-cell *matHeaderCellDef mat-sort-header> Tipo </th>
                                                                     <td mat-cell *matCellDef="let elementTransito"> {{elementTransito.s021_Tipo}} </td>
                                                             </ng-container>
                               
                                                             <ng-container matColumnDef="s021_Proteina">
                                                                     <th mat-header-cell *matHeaderCellDef mat-sort-header> Prot. % </th>
                                                                     <td mat-cell *matCellDef="let elementTransito"> {{elementTransito.s021_Proteina}} </td>
                                                             </ng-container>
                               
                                                             <ng-container matColumnDef="s021_Tolerancia">
                                                                     <th mat-header-cell *matHeaderCellDef mat-sort-header> Tolerancia </th>
                                                                     <td mat-cell *matCellDef="let elementTransito"> {{(elementTransito.s021_Tolerancia * 100) | number:'1.2-2' }} % </td>
                                                             </ng-container>
                               
                                                            <ng-container matColumnDef="s021_TipoPrecio">
                                                                      <th mat-header-cell *matHeaderCellDef mat-sort-header> Tipo de <br/>Precio </th> 
                                                                     <td mat-cell *matCellDef="let elementTransito"> {{elementTransito.s021_TipoPrecio}} </td>
                                                             </ng-container> 
                               
                                                             <ng-container matColumnDef="s021_Bolsa">
                                                                     <th mat-header-cell *matHeaderCellDef mat-sort-header> Ticker </th>
                                                                     <td mat-cell *matCellDef="let elementTransito"> {{elementTransito.s021_Bolsa}} </td>
                                                             </ng-container>
                               
                                                             <ng-container matColumnDef="s021_Futuro">
                                                                     <th mat-header-cell *matHeaderCellDef mat-sort-header> Futuro </th>
                                                                     <td mat-cell *matCellDef="let elementTransito"> {{elementTransito.s021_Futuro }} </td>
                                                             </ng-container>
                               
                                                             <ng-container matColumnDef="s021_Volumen">
                                                                     <th mat-header-cell *matHeaderCellDef mat-sort-header> Volumen (MT) </th>
                                                                     <td mat-cell *matCellDef="let elementTransito"> {{elementTransito.s021_Volumen}} </td>
                                                             </ng-container>
                               
                                                             <ng-container matColumnDef="s021_NumeroContratos">
                                                                     <th mat-header-cell *matHeaderCellDef mat-sort-header> # Contratos </th>
                                                                     <td mat-cell *matCellDef="let elementTransito"> {{elementTransito.s021_NumeroContratos | number:'1.0-0'}} </td>
                                                             </ng-container>
                               
                                                             <ng-container matColumnDef="s021_TipoBase">
                                                                     <th mat-header-cell *matHeaderCellDef mat-sort-header> Incoterm </th>
                                                                     <td mat-cell *matCellDef="let elementTransito"> {{elementTransito.s021_TipoBase}} </td>
                                                             </ng-container>
                               
                                                             <ng-container matColumnDef="s021_OtrosCostos">
                                                                     <th mat-header-cell *matHeaderCellDef mat-sort-header> Otros Costos / <br/>Descuentos </th>
                                                                     <td mat-cell *matCellDef="let elementTransito"> {{elementTransito.s021_OtrosCostos}} </td>
                                                             </ng-container>
                               
                                                             <ng-container matColumnDef="s021_FOBFijado">
                                                                     <th mat-header-cell *matHeaderCellDef mat-sort-header> FOB <br/> (U$S/MT) </th>
                                                                     <td mat-cell *matCellDef="let elementTransito"> {{elementTransito.s021_FOBFijado | number:'1.2-2'}} </td>
                                                             </ng-container>
                                                             <ng-container matColumnDef="s021_PnLAsignado">
                                                                     <th mat-header-cell *matHeaderCellDef mat-sort-header> PnL Asignado </th>
                                                                     <td mat-cell *matCellDef="let elementTransito"> {{elementTransito.s021_PnLAsignado}} </td>
                                                             </ng-container>
                                                             <ng-container matColumnDef="s021_Flete">
                                                                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Flete </th>
                                                                    <td mat-cell *matCellDef="let elementTransito"> {{elementTransito.s021_Flete}} </td>
                                                            </ng-container>
                                                            <ng-container matColumnDef="s021_ValorTotalFijado">
                                                                    <th mat-header-cell *matHeaderCellDef mat-sort-header> CFR (U$S/MT) </th>
                                                                    <td mat-cell *matCellDef="let elementTransito"> {{elementTransito.s021_ValorTotalFijado | number:'1.2-2'}} </td>
                                                            </ng-container>
                                                             <ng-container matColumnDef="ValorTotalUSD">
                                                                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Valor Total </th>
                                                                    <td mat-cell *matCellDef="let elementTransito"> {{(elementTransito.s021_ValorTotalFijado * elementTransito.s021_Volumen) | number:'1.2-2'}} </td>
                                                            </ng-container>
                                                            <ng-container matColumnDef="s021_Sustento">
                                                                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Sustento </th>
                                                                    <td mat-cell *matCellDef="let elementTransito"> {{elementTransito.s021_Sustento}} </td>
                                                            </ng-container>
                                        
                                                             <tr mat-header-row *matHeaderRowDef="columnsTransito sticky: true" 
                                                             style="text-align: center; vertical-align: middle;" ></tr>
                                                             
                                                             <tr class="tbody" mat-row *matRowDef="let elementTransito; columns: columnsTransito;"
                                                             style="text-align: center; vertical-align: middle;" 
                                                             [class.selected]="elementTransito.selected"
                                                             (click)="elementTransito.selected= !elementTransito.selected"
                                                             >
                                                             </tr>
                                                     </table>
                                             </div>
                                            </div>
                                            <mat-paginator #paginatorTransito="matPaginator" [pageSizeOptions]="[10,15, 25, 100]"></mat-paginator>
                                    </div>
    
                            </div>
                           
                            <mat-menu #menuTriggerTransito="matMenu">
                                    <ng-template matMenuContent let-item="item">
                                            <button mat-menu-item (click)="moverInventario(PasarTransito)">Mover a Inventario</button>       
                                            <button mat-menu-item (click)="regresarBarcoOpen()" [disabled]="!usuarioFO">Regresar a Open</button>              
                                    </ng-template>
                            </mat-menu>                               
                      <!-- </form> -->
                    </mat-step>
                    <mat-step label="Inventario">
                      <ng-template matStepLabel>INVENTARIO<span class="material-icons-round">inventory</span></ng-template>
                      <br>
                      <div class="card">
                            <div class="card-header">
                            </div>    
                            <div class="card-body">
                                    <div>
                                            <input type="text" class="redondeado buscador"  size="100"    (keyup)="applyFilterInventario($event)" placeholder=" Buscar Inventario" autocomplete="off">
                                            <br><br>
                                    </div>
                                   <div  class="table-responsive">
                                     <div class="tabla-table-container">
                                             <table mat-table 
                                             #sortPortafolioInventario="matSort"
                                             class="table table-bordered text-nowrap"  
                                             class="example-table table-bordered"
                                             matSort matSortActive="created" matSortDisableClear matSortDirection="desc"
                                             style="width:100%"  
                                             [dataSource]="portafolioInventariosDS" >
            
                                                     <ng-container class="border-bottom-0" matColumnDef="s056_TipoPrecio">
                                                       <th mat-header-cell *matHeaderCellDef mat-sort-header> Tipo Precio </th>
                                                       <td mat-cell *matCellDef="let elementInventario"> {{elementInventario.s056_TipoPrecio}} </td>
                                                     </ng-container>
                                                     <ng-container class="border-bottom-0" matColumnDef="s056_Sociedad">
                                                       <th mat-header-cell *matHeaderCellDef mat-sort-header> Sociedad </th>
                                                       <td mat-cell *matCellDef="let elementInventario"> {{elementInventario.s056_Sociedad}} </td>
                                                     </ng-container>
                                             
                                                     <ng-container  class="border-bottom-0" matColumnDef="s056_FechaActualizacion">
                                                       <th mat-header-cell *matHeaderCellDef mat-sort-header> Fecha <br/>Actualización </th>
                                                       <td mat-cell *matCellDef="let elementInventario"> {{elementInventario.s056_FechaActualizacion | date: "dd/MM/yyyy"}} </td>
                                                     </ng-container>
                                                     <ng-container  class="border-bottom-0" matColumnDef="s056_CodigoFisico">
                                                             <th mat-header-cell *matHeaderCellDef mat-sort-header> Código <br/>Físico </th>
                                                             <td mat-cell *matCellDef="let elementInventario"> {{elementInventario.s056_CodigoFisico}} </td>
                                                     </ng-container>                      
                                                     <ng-container class="border-bottom-0" matColumnDef="s056_ToneladasMetricas">
                                                             <th mat-header-cell *matHeaderCellDef mat-sort-header> Toneladas <br/>Métricas </th> 
                                                             <td mat-cell *matCellDef="let elementInventario">  {{elementInventario.s056_ToneladasMetricas | number:'1.2-2'}} </td>
                                                     </ng-container>
                                                     <ng-container matColumnDef="s056_Contratos">
                                                             <th mat-header-cell *matHeaderCellDef mat-sort-header> Contratos </th>
                                                             <td mat-cell *matCellDef="let elementInventario"> {{elementInventario.s056_Contratos | number:'1.2-2'}} </td>
                                                     </ng-container>
                                                     <ng-container matColumnDef="s056_Producto">
                                                             <th mat-header-cell *matHeaderCellDef mat-sort-header> Producto</th>
                                                             <td mat-cell *matCellDef="let elementInventario"> {{elementInventario.s056_Producto}} </td>
                                                     </ng-container>
                                                     <ng-container matColumnDef="s056_Proteina">
                                                             <th mat-header-cell *matHeaderCellDef mat-sort-header> Proteína </th>
                                                             <td mat-cell *matCellDef="let elementInventario"> {{elementInventario.s056_Proteina}} </td>
                                                     </ng-container>
                       
                                                     <ng-container matColumnDef="s056_Puerto">
                                                             <th mat-header-cell *matHeaderCellDef mat-sort-header> Puerto </th>
                                                             <td mat-cell *matCellDef="let elementInventario"> {{elementInventario.s056_Puerto}} </td>
                                                     </ng-container>
                       
                                                     <ng-container matColumnDef="s056_Mercado">
                                                             <th mat-header-cell *matHeaderCellDef mat-sort-header> Mercado </th>
                                                             <td mat-cell *matCellDef="let elementInventario"> {{elementInventario.s056_Mercado}} </td>
                                                     </ng-container>
                       
                                                     <ng-container matColumnDef="s056_FOB">
                                                             <th mat-header-cell *matHeaderCellDef mat-sort-header> FOB </th>
                                                             <td mat-cell *matCellDef="let elementInventario"> {{elementInventario.s056_FOB | number:'1.2-2'}} </td>
                                                     </ng-container>
                                                     <ng-container matColumnDef="valorTotal">
                                                             <th mat-header-cell *matHeaderCellDef mat-sort-header> Valor Total </th>
                                                             <td mat-cell *matCellDef="let elementInventario"> {{(elementInventario.s056_FOB * elementInventario.s056_Contratos * elementInventario.s056_FactorUnidadMedida * elementInventario.s056_FactorToneladas)  | number:'1.2-2'}} </td>
                                                     </ng-container>
                       
                                                     <tr mat-header-row *matHeaderRowDef="columnsInventario sticky: true" 
                                                     style="text-align: center; vertical-align: middle;" ></tr>
                                                     
                                                     <tr class="tbody" (contextmenu)="onContextMenu($event, elementInventario.s021_Codigo)" mat-row *matRowDef="let elementInventario; columns: columnsInventario;"
                                                     style="text-align: center; vertical-align: middle;" 
                                                     [class.selected]="elementInventario.selected"
                                                     (click)="elementInventario.selected= !elementInventario.selected"
                                                     >
                                                     </tr>
                                             </table>
                                     </div>
                                    </div>
                                    <mat-paginator #paginatorInventario="matPaginator" [pageSizeOptions]="[10,15, 25, 100]"></mat-paginator>
                            </div>                    
                      </div>
                    </mat-step>
                </mat-stepper>
            </div>
        </div>
    </div>
    <ng-template #IngresarFactura let-modal >
        <app-gestion-operaciones (closegestionOperacion)="cerrarModalOperacion(modal)" [objForm] = "objetoInitPadre" [tmFijadasBases] = "tmFijadasBasesPadre" [contratosFijadasFuturos] = "contratosFijadasFuturosPadre"></app-gestion-operaciones>
    </ng-template>
    <ng-template #ListarBases let-modal >
        <app-lista-bases (closelistaBases)="cerrarModalOperacion(modal)" [listaBasesCM] = "listabases"></app-lista-bases>
    </ng-template>
    <ng-template #IngresarBase let-modal >
        <app-ingresar-bases (closeAgregarBase)="cerrarModalOperacion(modal)" [objInitIngresoBase] = "objetoInitIngresoBase"></app-ingresar-bases>
    </ng-template>
    <ng-template #ListaHijos let-modal >
        <app-lista-hijos (closeListaHijos)="cerrarModalOperacion(modal)" [objInitListaSplit] = "objetoInitListaSplit"></app-lista-hijos>
    </ng-template>
    <ng-template #PasarTransito let-modal >
        <app-pasar-transito (closeDescarga)="cerrarModalOperacion(modal)" [objInitDescargar] = "objetoDescargar"></app-pasar-transito>
    </ng-template>
    <ng-template #cerrarPortafolio let-modal >
        <app-cierre-fisico (closeCierreFisico)="cerrarModalOperacion(modal)" [objCierre] = "objetoInitCierre"></app-cierre-fisico>
    </ng-template>

    <ng-template #crearPricing let-modal >
        <app-crear-futuro (closecreacionFuturo)="cerrarModalOperacion(modal)" [objetoInitCrearFuturo] = "objetoInitCrearFuturo"></app-crear-futuro>
    </ng-template>

    <ng-template #asignarPricing let-modal >
        <app-asignar-futuro (closeAsignarFuturo)="cerrarModalOperacion(modal)" [objetoInitAsignarFuturo] = "objetoInitAsignarFuturo" [saldoContratosFuturos]="saldoContratosFuturosPadre"></app-asignar-futuro>
    </ng-template>

    <ng-template #comprarFuturo let-modal >
        <app-comprar-futuro (closecomprarFuturo)="cerrarModalOperacion(modal)" [objetoInitCompraFuturo] = "objetoInitCompraFuturo"></app-comprar-futuro>
    </ng-template>

    <ng-template #venderFuturo let-modal >
        <app-vender-futuro (closeVenderFuturo)="cerrarModalOperacion(modal)" [objetoInitVentaFuturo] = "objetoInitVentaFuturo"></app-vender-futuro>
    </ng-template>

    <ng-template #listarFuturos let-modal >
        <app-listar-futuro (cerrarListarFuturo)="cerrarModalOperacion(modal)" [listaFuturos] = "listaFuturos"></app-listar-futuro>
    </ng-template>

    <ng-template #consultaPortafolio let-modal>
        <div role="document" > <!--class="msg_card_body" -->
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Consulta del Portafolio del Físico</h5>
              <button
                type="button"
                class="btn-close"
                (click)="modal.dismiss('Cross click')"
              >
                <span aria-hidden="true">×</span>
              </button>
            </div>
            <div class="modal-body">
              <div class="py-1">
                <form class="form" novalidate="">
                  <div class="row">
                    <div class="col col-xl-12 col-lg-21 col-md-12">
                      <div class="row">
                        <div class="col-xl-4 col-lg-4 col-md-4">
                          <label class="form-label">Concepto:</label>
                        </div>
                        <div class="col-xl-8 col-lg-8 col-md-8">
                          <ng-select
                            class="form-control form-select"
                            name="ConsultaConcepto"
                            [(ngModel)]="ConsultaConcepto">
                            <ng-option
                            value="{{ item.s204_ID }}"
                            *ngFor="let item of comboConcepto"
                            >{{ item.s204_Description }}</ng-option>
                            [disabled]="!flgConcepto"
                          </ng-select>
                        </div>
                      </div>
                      <span class="br"></span>
                      <div class="row">
                        <mat-checkbox class="checkCierre" name="flgFechaConsultaPortafolio" [(ngModel)]="flgFechaConsultaPortafolio" (ngModelChange)="habilitarFechas()">Consultar por rango de fechas</mat-checkbox>
                      </div>
                      <div class="row" [hidden]="!flgFechaConsultaPortafolio">
                        <div class="col-xl-1 col-lg-4 col-md-1">
                          <label class="form-label">Fecha Inicio:</label>
                        </div>
                        <div class="col-xl-4 col-lg-4 col-md-4">
                          <input
                            id="dtpFecIni"
                            class="form-control"
                            type="date"
                            placeholder="yyyy-mm-dd"
                            [(ngModel)]="fechInicio"
                            ngbDatepicker
                            (click)="d1.toggle()"
                            #d1="ngbDatepicker"
                            [maxDate]="maxDate"
                            (ngModelChange)="cambiarFechaIni()"
                            readonly
                          />
                        </div>
                        <div class="col-xl-1 col-lg-4 col-md-2">
                          <label class="form-label">Fecha Fin:</label>
                        </div>
                        <div class="col-xl-4 col-lg-4 col-md-4">
                          <input
                            class="form-control"
                            type="date"
                            placeholder="yyyy-mm-dd"
                            [(ngModel)]="fechFin"
                            ngbDatepicker
                            (click)="d2.toggle()"
                            #d2="ngbDatepicker"
                            [minDate]="minDate"
                            (ngModelChange)="cambiarFechaFin()"
                            readonly
                          />
                        </div>
                      </div>
                      <span class="br"></span>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col d-flex justify-content-end">
                      <button
                        class="btn btn-green"
                        type="submit"
                        (click)="exportarConsulta(consultaPortafolio)">
                        Aceptar
                      </button>
                    </div>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
      </ng-template>

    <mat-spinner  class="custom-spinner"
        *ngIf="loading$ | async"  
        [mode]="'indeterminate'"
        [value]=50
        [diameter]="50">
    </mat-spinner>

